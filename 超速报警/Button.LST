C51 COMPILER V9.00   BUTTON                                                                05/25/2016 13:04:47 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN Button.OBJ
COMPILER INVOKED BY: E:\software\DevelopmentSoftware\InstallSrc\KeilC51\C51\BIN\C51.EXE Button.c COMPACT BROWSE DEBUG OB
                    -JECTEXTEND

line level    source

   1          #include "stc15.h"
   2          #include "Delay.h"
   3          #include "LCD12864.H"
   4          #include "main.h"
   5          #include "Timer.h"
   6          #include "Button.h"
   7          
   8          unsigned char code SetString[] = {"设置："};
   9          
  10          void INT0_Init()
  11          {       
  12   1              IT0=1;                                          // 设置为下降沿触发
  13   1              EX0=1;                                          // 开外部中断0                    P3.2 INT0
  14   1      }
  15          void EXT0(void) interrupt 0
  16          {
  17   1          Delay20ms();
  18   1              Delay20ms();
  19   1              if(P32==0)                                                      // 仍然是按下状态
  20   1              {
  21   2                      if(ISSETTING==0)
  22   2                      { 
  23   3                          P20 = !P20;
  24   3                              ISSETTING=1;
  25   3                              DisableTimer0();                        // 关闭超声波 温湿度的定时器中断
  26   3                              DisableTimer3();                        // 关闭蜂鸣器的定时器中断
  27   3                      }
  28   2                      else
  29   2                      {
  30   3                          //P26 = !P26;
  31   3                          ISSETTING=0;
  32   3                              EXITSETTING=1; 
  33   3                              EnableTimer0();                         // 关闭超声波 温湿度的定时器中断
  34   3                              EnableTimer3();                         // 关闭蜂鸣器的定时器中断                       
  35   3                      }
  36   2              }
  37   1              else                                                            // 抖动
  38   1              {
  39   2                      ; 
  40   2              }       
  41   1      }
  42          
  43          void EnterSetting()
  44          {
  45   1          //unsigned char VelocityUp[] = {"速度上限：   m/s"};
  46   1              //LCD12864ClearScreen();
  47   1              //unsigned char Velocity1 = (unsigned char)(0 + 48);
  48   1              //unsigned char Velocity2 = (unsigned char)(0 + 48);
  49   1              //unsigned char VeloCitySetting1[] = {"速度上限：0."};
  50   1              //unsigned char VeloCitySetting2[] = {"速度上限：0.0m"};
  51   1              unsigned char Loc = 1;
  52   1      
  53   1              unsigned char LeftVelocityValue = 0;
  54   1              unsigned char RightVelocityValue = 0;
C51 COMPILER V9.00   BUTTON                                                                05/25/2016 13:04:47 PAGE 2   

  55   1      
  56   1          LCD12864SettingInit();
  57   1              //Display_String(1,SetString);
  58   1              //Display_String(2,VelocityUp);
  59   1      
  60   1               
  61   1              do                                                              //矩阵键盘按键扫描
  62   1              {
  63   2                  KeyOut1 = 0;
  64   2                      if(KeyIn1 == 0)                                                                         //调节左右
  65   2                      {       
  66   3                      Delay20ms();
  67   3                              Delay20ms();
  68   3                              if(KeyIn1 == 1) continue;
  69   3                              //sbit KeyOut1 = P3^5;
  70   3      //sbit KeyIn1  = P3^4;
  71   3      //sbit KeyIn2  = P3^6;
  72   3                              P20 = !P20;
  73   3                              if(Loc == 1)                                               
  74   3                              {
  75   4                                      Loc = 2;
  76   4                                      //Display_String(1,VeloCitySetting2);
  77   4                                      LCD12864DisplayChar(1,6,RightVelocityValue + 48);
  78   4                              }
  79   3                              else
  80   3                              {
  81   4                                      Loc = 1;
  82   4                                      LCD12864DisplayChar(1,4,LeftVelocityValue + 48);
  83   4                                      //Display_String(1,VeloCitySetting1);                           
  84   4                              }
  85   3                              while(KeyIn1==0);
  86   3                      }
  87   2                      else                                                                            //调节值
  88   2                      {
  89   3                      Delay20ms();
  90   3                              Delay20ms();
  91   3                              if(KeyIn2 == 1) continue;
  92   3                              if(Loc == 1)                                               
  93   3                              {
  94   4                                  if(LeftVelocityValue==9)
  95   4                                      {       
  96   5                                          LeftVelocityValue = 0;
  97   5                                      LCD12864DisplayChar(1,4,0+48);
  98   5                                      }
  99   4                                      else
 100   4                                      {
 101   5                                              LCD12864DisplayChar(1,4,++LeftVelocityValue+48);
 102   5                                      }
 103   4                              }
 104   3                              else
 105   3                              {
 106   4                                  if(RightVelocityValue==9)
 107   4                                      {       
 108   5                                          RightVelocityValue = 0;
 109   5                                      LCD12864DisplayChar(1,6,0+48);
 110   5                                      }
 111   4                                      else
 112   4                                      {
 113   5                                              LCD12864DisplayChar(1,6,++RightVelocityValue+48);
 114   5                                      }                               
 115   4                              }
 116   3                              while(KeyIn2==0);                       
C51 COMPILER V9.00   BUTTON                                                                05/25/2016 13:04:47 PAGE 3   

 117   3                      }
 118   2              }       
 119   1              while(EXITSETTING == 0);                                                //当没有退出循环时在里面
 120   1              LCD12864SettingExit();
 121   1              EXITSETTING = 0;
 122   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    256    ----
   CONSTANT SIZE    =      7    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       3
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
